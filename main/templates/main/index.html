{% extends 'base.html' %} {% load static %} {% block content %}
<h1>Заявки сотрудников</h1>
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Сотрудник</th>
            <th>Заявка</th>
        </tr>
    </thead>
    <tbody>
        {% for pa in personal_applications %}
        <tr>
            <td>{{ pa.id_pa }}</td>
            <td>{{ pa.person.FIO }}</td>
            <td>{{ pa.application.id }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% if user.is_superuser %}
<!-- Кнопка для выполнения действия -->
<button id="actionButton" type="button" class="btn btn-dark">Распределить</button>
<!-- Элемент для отображения сообщения -->
<div id="message" class="mt-3" style="display: none">Выполнено</div>
{% endif %}
<!-- Элементы для отображения результатов -->
<p id="distance"></p>
<p id="shortest_path"></p>
<!-- Подключаем локальный файл jQuery -->
<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
{% if user.is_superuser %}
<script>
    // нажатие кнопки
    document.getElementById("actionButton").addEventListener("click", function () {
        $.ajax({
            url: "{% url 'main:distribute_tasks' %}",
            type: "GET",
            success: function (data) {
                document.getElementById("message").style.display = "block";
                $("#distance").text("distance: " + data.distance);
                $("#shortest_path").text("shortest_path: " + data.shortest_path);
            },
            error: function () {
                alert("Ошибка при распределении задач.");
            },
        });
    });
</script>
{% endif %} {% endblock content %}
